!function i(a,u,c){function s(e,t){if(!u[e]){if(!a[e]){var r="function"==typeof require&&require;if(!t&&r)return r(e,!0);if(f)return f(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var o=u[e]={exports:{}};a[e][0].call(o.exports,function(t){return s(a[e][1][t]||t)},o,o.exports,i,a,u,c)}return u[e].exports}for(var f="function"==typeof require&&require,t=0;t<c.length;t++)s(c[t]);return s}({1:[function(t,e,r){e.exports=t("regenerator-runtime")},{"regenerator-runtime":5}],2:[function(t,e,r){var a=/\b(Array|Date|Object|Math|JSON)\b/g;e.exports=function(t,e){var r,n,o,i=function(t){for(var e=[],r=0;r<t.length;r++)~e.indexOf(t[r])||e.push(t[r]);return e}(t.replace(/\.\w+|\w+ *\(|"[^"]*"|'[^']*'|\/([^/]+)\//g,"").replace(a,"").match(/[a-zA-Z_]\w*/g)||[]);return e&&"string"==typeof e&&(r=e,e=function(t){return r+t}),e?(n=i,o=e,t.replace(/\.\w+|\w+ *\(|"[^"]*"|'[^']*'|\/([^/]+)\/|[a-zA-Z_]\w*/g,function(t){return"("==t[t.length-1]?o(t):~n.indexOf(t)?o(t):t})):i}},{}],3:[function(t,e,r){var i=t("to-function");e.exports=function(t,e){var r,n={};e=i(e);for(var o=0;o<t.length;++o)n[r=e(t[o],o)]=n[r]||[],n[r].push(t[o]);return n}},{"to-function":7}],4:[function(t,r,e){!function(t,e){"use strict";"object"==typeof r&&"object"==typeof r.exports?r.exports=e():"function"==typeof define&&define.amd?define([],e):t.objectPath=e()}(this,function(){"use strict";var e=Object.prototype.toString;function i(t,e){return null!=t&&Object.prototype.hasOwnProperty.call(t,e)}function f(t){if(!t)return!0;if(h(t)&&0===t.length)return!0;if("string"!=typeof t){for(var e in t)if(i(t,e))return!1;return!0}return!1}function l(t){return e.call(t)}var h=Array.isArray||function(t){return"[object Array]"===e.call(t)};function p(t){var e=parseInt(t);return e.toString()===t?e:t}function t(o){o=o||{};var a=function(r){return Object.keys(a).reduce(function(t,e){return"create"===e||"function"==typeof a[e]&&(t[e]=a[e].bind(a,r)),t},{})};function u(t,e){return o.includeInheritedProps||"number"==typeof e&&Array.isArray(t)||i(t,e)}function c(t,e){if(u(t,e))return t[e]}function s(t,e,r,n){if("number"==typeof e&&(e=[e]),!e||0===e.length)return t;if("string"==typeof e)return s(t,e.split(".").map(p),r,n);var o=e[0],i=c(t,o);return 1===e.length?(void 0!==i&&n||(t[o]=r),i):(void 0===i&&("number"==typeof e[1]?t[o]=[]:t[o]={}),s(t[o],e.slice(1),r,n))}return a.has=function(t,e){if("number"==typeof e?e=[e]:"string"==typeof e&&(e=e.split(".")),!e||0===e.length)return!!t;for(var r=0;r<e.length;r++){var n=p(e[r]);if(!("number"==typeof n&&h(t)&&n<t.length||(o.includeInheritedProps?n in Object(t):i(t,n))))return!1;t=t[n]}return!0},a.ensureExists=function(t,e,r){return s(t,e,r,!0)},a.set=function(t,e,r,n){return s(t,e,r,n)},a.insert=function(t,e,r,n){var o=a.get(t,e);n=~~n,h(o)||(o=[],a.set(t,e,o)),o.splice(n,0,r)},a.empty=function(t,e){var r,n;if(!f(e)&&(null!=t&&(r=a.get(t,e)))){if("string"==typeof r)return a.set(t,e,"");if("boolean"==typeof(i=r)||"[object Boolean]"===l(i))return a.set(t,e,!1);if("number"==typeof r)return a.set(t,e,0);if(h(r))r.length=0;else{if("object"!=typeof(o=r)||"[object Object]"!==l(o))return a.set(t,e,null);for(n in r)u(r,n)&&delete r[n]}var o,i}},a.push=function(t,e){var r=a.get(t,e);h(r)||(r=[],a.set(t,e,r)),r.push.apply(r,Array.prototype.slice.call(arguments,2))},a.coalesce=function(t,e,r){for(var n,o=0,i=e.length;o<i;o++)if(void 0!==(n=a.get(t,e[o])))return n;return r},a.get=function(t,e,r){if("number"==typeof e&&(e=[e]),!e||0===e.length)return t;if(null==t)return r;if("string"==typeof e)return a.get(t,e.split("."),r);var n=p(e[0]),o=c(t,n);return void 0===o?r:1===e.length?o:a.get(t[n],e.slice(1),r)},a.del=function(t,e){if("number"==typeof e&&(e=[e]),null==t)return t;if(f(e))return t;if("string"==typeof e)return a.del(t,e.split("."));var r=p(e[0]);return u(t,r)?1!==e.length?a.del(t[r],e.slice(1)):(h(t)?t.splice(r,1):delete t[r],t):t},a}var r=t();return r.create=t,r.withInheritedProps=t({includeInheritedProps:!0}),r})},{}],5:[function(t,e,r){var n=function(){return this}()||Function("return this")(),o=n.regeneratorRuntime&&0<=Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime"),i=o&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=t("./runtime"),o)n.regeneratorRuntime=i;else try{delete n.regeneratorRuntime}catch(t){n.regeneratorRuntime=void 0}},{"./runtime":6}],6:[function(t,C,e){!function(t){"use strict";var c,e=Object.prototype,s=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",n=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag",a="object"==typeof C,u=t.regeneratorRuntime;if(u)a&&(C.exports=u);else{(u=t.regeneratorRuntime=a?C.exports:{}).wrap=m;var l="suspendedStart",h="suspendedYield",p="executing",d="completed",y={},f={};f[o]=function(){return this};var v=Object.getPrototypeOf,g=v&&v(v(E([])));g&&g!==e&&s.call(g,o)&&(f=g);var b=O.prototype=x.prototype=Object.create(f);k.prototype=b.constructor=O,O.constructor=k,O[i]=k.displayName="GeneratorFunction",u.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===k||"GeneratorFunction"===(e.displayName||e.name))},u.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,O):(t.__proto__=O,i in t||(t[i]="GeneratorFunction")),t.prototype=Object.create(b),t},u.awrap=function(t){return{__await:t}},_(j.prototype),j.prototype[n]=function(){return this},u.AsyncIterator=j,u.async=function(t,e,r,n){var o=new j(m(t,e,r,n));return u.isGeneratorFunction(e)?o:o.next().then(function(t){return t.done?t.value:o.next()})},_(b),b[i]="Generator",b[o]=function(){return this},b.toString=function(){return"[object Generator]"},u.keys=function(r){var n=[];for(var t in r)n.push(t);return n.reverse(),function t(){for(;n.length;){var e=n.pop();if(e in r)return t.value=e,t.done=!1,t}return t.done=!0,t}},u.values=E,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(T),!t)for(var e in this)"t"===e.charAt(0)&&s.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=c)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function t(t,e){return i.type="throw",i.arg=r,n.next=t,e&&(n.method="next",n.arg=c),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var o=this.tryEntries[e],i=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var a=s.call(o,"catchLoc"),u=s.call(o,"finallyLoc");if(a&&u){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&s.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:E(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=c),y}}}function m(t,e,r,n){var i,a,u,c,o=e&&e.prototype instanceof x?e:x,s=Object.create(o.prototype),f=new L(n||[]);return s._invoke=(i=t,a=r,u=f,c=l,function(t,e){if(c===p)throw new Error("Generator is already running");if(c===d){if("throw"===t)throw e;return A()}for(u.method=t,u.arg=e;;){var r=u.delegate;if(r){var n=P(r,u);if(n){if(n===y)continue;return n}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if(c===l)throw c=d,u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c=p;var o=w(i,a,u);if("normal"===o.type){if(c=u.done?d:h,o.arg===y)continue;return{value:o.arg,done:u.done}}"throw"===o.type&&(c=d,u.method="throw",u.arg=o.arg)}}),s}function w(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}function x(){}function k(){}function O(){}function _(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function j(c){var e;this._invoke=function(r,n){function t(){return new Promise(function(t,e){!function e(t,r,n,o){var i=w(c[t],c,r);if("throw"!==i.type){var a=i.arg,u=a.value;return u&&"object"==typeof u&&s.call(u,"__await")?Promise.resolve(u.__await).then(function(t){e("next",t,n,o)},function(t){e("throw",t,n,o)}):Promise.resolve(u).then(function(t){a.value=t,n(a)},o)}o(i.arg)}(r,n,t,e)})}return e=e?e.then(t,t):t()}}function P(t,e){var r=t.iterator[e.method];if(r===c){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=c,P(t,e),"throw"===e.method))return y;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var n=w(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,y;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=c),e.delegate=null,y):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,y)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function E(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(s.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=c,t.done=!0,t};return n.next=n}}return{next:A}}function A(){return{value:c,done:!0}}}(function(){return this}()||Function("return this")())},{}],7:[function(e,t,r){var i;try{i=e("props")}catch(t){i=e("component-props")}function n(t){switch({}.toString.call(t)){case"[object Object]":return function(t){var r={};for(var e in t)r[e]="string"==typeof t[e]?o(t[e]):n(t[e]);return function(t){if("object"!=typeof t)return!1;for(var e in r){if(!(e in t))return!1;if(!r[e](t[e]))return!1}return!0}}(t);case"[object Function]":return t;case"[object String]":return/^ *\W+/.test(r=t)?new Function("_","return _ "+r):new Function("_","return "+function(t){var e,r,n,o=i(t);if(!o.length)return"_."+t;for(r=0;r<o.length;r++)n=o[r],t=a(n,t,e="('function' == typeof "+(e="_."+n)+" ? "+e+"() : "+e+")");return t}(r));case"[object RegExp]":return e=t,function(t){return e.test(t)};default:return o(t)}var e,r}function o(e){return function(t){return e===t}}function a(t,e,r){return e.replace(new RegExp("(\\.)?"+t,"g"),function(t,e){return e?t:r})}t.exports=n},{"component-props":2,props:2}],8:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LocalStorageAdapter=r.InMemoryAdapter=void 0;var n=i(t("./inmemory")),o=i(t("./localstorage"));function i(t){return t&&t.__esModule?t:{default:t}}r.InMemoryAdapter=n.default,r.LocalStorageAdapter=o.default},{"./inmemory":9,"./localstorage":10}],9:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,o=t("babel-runtime/regenerator"),a=(n=o)&&n.__esModule?n:{default:n},u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},c=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();function s(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function f(t){return function(){var u=t.apply(this,arguments);return new Promise(function(i,a){return function e(t,r){try{var n=u[t](r),o=n.value}catch(t){return void a(t)}if(!n.done)return Promise.resolve(o).then(function(t){e("next",t)},function(t){e("throw",t)});i(o)}("next")})}}var i=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.store={},this.config=t,this.prefix=this.config.get("prefix")}var r,n,o,i;return c(e,[{key:"get",value:(i=f(a.default.mark(function t(e){var r;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.storageName(e),t.abrupt("return",[].concat(s(this.getCollection(r))));case 2:case"end":return t.stop()}},t,this)})),function(t){return i.apply(this,arguments)})},{key:"set",value:(o=f(a.default.mark(function t(e,r){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.store[this.storageName(e)]=[].concat(s(r)),t.abrupt("return",r);case 2:case"end":return t.stop()}},t,this)})),function(t,e){return o.apply(this,arguments)})},{key:"has",value:(n=f(a.default.mark(function t(e){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object.prototype.hasOwnProperty.call(this.store,this.storageName(e)));case 1:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"clear",value:(r=f(a.default.mark(function t(e){var r;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.has(e);case 2:if(!t.sent){t.next=6;break}t.t0=delete this.store[this.storageName(e)],t.next=7;break;case 6:t.t0=!1;case 7:return r=t.t0,this.store=u({},this.store),t.abrupt("return",r);case 10:case"end":return t.stop()}},t,this)})),function(t){return r.apply(this,arguments)})},{key:"storageName",value:function(t){return t.startsWith(this.getPrefix())?t:this.getPrefix()+"_"+t}},{key:"getPrefix",value:function(){return this.config.get("prefix")}},{key:"getCollection",value:function(t){return Object.prototype.hasOwnProperty.call(this.store,t)||(this.store[t]=[]),this.store[t]}}]),e}();r.default=i},{"babel-runtime/regenerator":1}],10:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,o=t("babel-runtime/regenerator"),a=(n=o)&&n.__esModule?n:{default:n},u=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();function c(t){return function(){var u=t.apply(this,arguments);return new Promise(function(i,a){return function e(t,r){try{var n=u[t](r),o=n.value}catch(t){return void a(t)}if(!n.done)return Promise.resolve(o).then(function(t){e("next",t)},function(t){e("throw",t)});i(o)}("next")})}}var i=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.prefix=this.config.get("prefix")}var r,n,o,i;return u(e,[{key:"get",value:(i=c(a.default.mark(function t(e){var r;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=localStorage.getItem(this.storageName(e)),t.abrupt("return",JSON.parse(r)||[]);case 2:case"end":return t.stop()}},t,this)})),function(t){return i.apply(this,arguments)})},{key:"set",value:(o=c(a.default.mark(function t(e,r){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return localStorage.setItem(this.storageName(e),JSON.stringify(r)),t.abrupt("return",r);case 2:case"end":return t.stop()}},t,this)})),function(t,e){return o.apply(this,arguments)})},{key:"has",value:(n=c(a.default.mark(function t(e){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object.prototype.hasOwnProperty.call(localStorage,this.storageName(e)));case 1:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"clear",value:(r=c(a.default.mark(function t(e){var r;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.has(e);case 2:if(!t.sent){t.next=6;break}t.t0=delete localStorage[this.storageName(e)],t.next=7;break;case 6:t.t0=!1;case 7:return r=t.t0,t.abrupt("return",r);case 9:case"end":return t.stop()}},t,this)})),function(t){return r.apply(this,arguments)})},{key:"storageName",value:function(t){return t.startsWith(this.getPrefix())?t:this.getPrefix()+"_"+t}},{key:"getPrefix",value:function(){return this.config.get("prefix")}}]),e}();r.default=i},{"babel-runtime/regenerator":1}],11:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var f=n(t("babel-runtime/regenerator")),l=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}(),h=n(t("./event")),p=n(t("./storage-capsule")),d=n(t("./queue")),y=t("./utils"),v=t("./helpers"),g=t("./console");function n(t){return t&&t.__esModule?t:{default:t}}function b(t){return function(){var u=t.apply(this,arguments);return new Promise(function(i,a){return function e(t,r){try{var n=u[t](r),o=n.value}catch(t){return void a(t)}if(!n.done)return Promise.resolve(o).then(function(t){e("next",t)},function(t){e("throw",t)});i(o)}("next")})}}var m=Symbol("channel-name"),o=function(){function o(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this.stopped=!0,this.running=!1,this.event=new h.default,this.config=e,this[m]=t;var r=d.default.drivers,n=new p.default(e,r.storage);this.storage=n.channel(t)}var e,r,n,i,t,a,u,c,s;return l(o,[{key:"name",value:function(){return this[m]}},{key:"add",value:(s=b(f.default.mark(function t(e){var r;return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.canMultiple.call(this,e);case 2:if(t.sent){t.next=4;break}return t.abrupt("return",!1);case 4:return t.next=6,v.saveTask.call(this,e);case 6:if(!(r=t.sent)||!this.stopped||!0!==this.running){t.next=10;break}return t.next=10,this.start();case 10:return v.logProxy.call(this,g.taskAddedLog,e),t.abrupt("return",r);case 12:case"end":return t.stop()}},t,this)})),function(t){return s.apply(this,arguments)})},{key:"next",value:(c=b(f.default.mark(function t(){return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.stopped){t.next=3;break}return v.statusOff.call(this),t.abrupt("return",v.stopQueue.call(this));case 3:return v.logProxy.call(this,g.nextTaskLog,"next"),t.next=6,this.start();case 6:return t.abrupt("return",!0);case 7:case"end":return t.stop()}},t,this)})),function(){return c.apply(this,arguments)})},{key:"start",value:(u=b(f.default.mark(function t(){return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.stopped=!1,v.logProxy.call(this,g.queueStartLog,"start"),t.next=4,v.createTimeout.call(this);case 4:return t.t0=t.sent,this.running=0<t.t0,t.abrupt("return",this.running);case 7:case"end":return t.stop()}},t,this)})),function(){return u.apply(this,arguments)})},{key:"stop",value:function(){v.logProxy.call(this,g.queueStoppingLog,"stop"),this.stopped=!0}},{key:"forceStop",value:function(){v.stopQueue.call(this)}},{key:"isEmpty",value:(a=b(f.default.mark(function t(){return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.count();case 2:return t.t0=t.sent,t.abrupt("return",t.t0<1);case 4:case"end":return t.stop()}},t,this)})),function(){return a.apply(this,arguments)})},{key:"count",value:(t=b(f.default.mark(function t(){return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.getTasksWithoutFreezed.call(this);case 2:return t.abrupt("return",t.sent.length);case 3:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"countByTag",value:(i=b(f.default.mark(function t(e){return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.getTasksWithoutFreezed.call(this);case 2:return t.t0=function(t){return t.tag===e},t.abrupt("return",t.sent.filter(t.t0).length);case 4:case"end":return t.stop()}},t,this)})),function(t){return i.apply(this,arguments)})},{key:"clear",value:function(){return!!this.name()&&(this.storage.clear(this.name()),!0)}},{key:"clearByTag",value:(n=b(f.default.mark(function t(e){var n,r,o,i=this;return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this,t.next=3,v.db.call(n).all();case 3:return r=t.sent,o=r.filter(y.utilClearByTag.bind(e)).map(function(){var e=b(f.default.mark(function t(e){var r;return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.db.call(n).delete(e._id);case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}},t,i)}));return function(t){return e.apply(this,arguments)}}()),t.next=7,Promise.all(o);case 7:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"has",value:(r=b(f.default.mark(function t(e){return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.getTasksWithoutFreezed.call(this);case 2:return t.t0=function(t){return t._id===e},t.t1=t.sent.findIndex(t.t0),t.t2=-1,t.abrupt("return",t.t1>t.t2);case 6:case"end":return t.stop()}},t,this)})),function(t){return r.apply(this,arguments)})},{key:"hasByTag",value:(e=b(f.default.mark(function t(e){return f.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.getTasksWithoutFreezed.call(this);case 2:return t.t0=function(t){return t.tag===e},t.t1=t.sent.findIndex(t.t0),t.t2=-1,t.abrupt("return",t.t1>t.t2);case 6:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"on",value:function(t,e){var r;(r=this.event).on.apply(r,[t,e]),v.logProxy.call(this,g.eventCreatedLog,t)}}]),o}();r.default=o},{"./console":13,"./event":17,"./helpers":18,"./queue":20,"./storage-capsule":21,"./utils":22,"babel-runtime/regenerator":1}],12:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,o=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}(),i=t("./enum/config.data"),a=(n=i)&&n.__esModule?n:{default:n};var u=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=a.default,this.merge(t)}return o(e,[{key:"set",value:function(t,e){this.config[t]=e}},{key:"get",value:function(t){return this.config[t]}},{key:"has",value:function(t){return Object.prototype.hasOwnProperty.call(this.config,t)}},{key:"merge",value:function(t){this.config=Object.assign({},this.config,t)}},{key:"remove",value:function(t){return delete this.config[t]}},{key:"all",value:function(){return this.config}}]),e}();r.default=u},{"./enum/config.data":15}],13:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var u=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{!n&&u.return&&u.return()}finally{if(o)throw i}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};r.log=c,r.taskAddedLog=function(t){var e=u(t,1)[0];c("%c"+String.fromCharCode(43)+" ("+e.handler+") -> "+o.default.get(i.default,"queue.created"),"color: green;font-weight: bold;")},r.queueStartLog=function(t){var e=u(t,1)[0];c("%c"+String.fromCharCode(8211)+" ("+e+") -> "+o.default.get(i.default,"queue.starting"),"color: #3fa5f3;font-weight: bold;")},r.nextTaskLog=function(t){var e=u(t,1)[0];c("%c"+String.fromCharCode(187)+" ("+e+") -> "+o.default.get(i.default,"queue.next"),"color: #3fa5f3;font-weight: bold;")},r.queueStoppingLog=function(t){var e=u(t,1)[0];c("%c"+String.fromCharCode(8226)+" ("+e+") -> "+o.default.get(i.default,"queue.stopping"),"color: #ff7f94;font-weight: bold;")},r.queueStoppedLog=function(t){var e=u(t,1)[0];c("%c"+String.fromCharCode(8226)+" ("+e+") -> "+o.default.get(i.default,"queue.stopped"),"color: #ff7f94;font-weight: bold;")},r.queueEmptyLog=function(t){c("%c"+u(t,1)[0]+" "+o.default.get(i.default,"queue.empty"),"color: #ff7f94;font-weight: bold;")},r.eventCreatedLog=function(t){c("%c("+u(t,1)[0]+") -> "+o.default.get(i.default,"event.created"),"color: #66cee3;font-weight: bold;")},r.eventFiredLog=function(t){var e=u(t,2),r=e[0],n=e[1];c("%c("+r+") -> "+o.default.get(i.default,"event."+n),"color: #a0dc3c;font-weight: bold;")},r.notFoundLog=function(t){var e=u(t,1)[0];c("%c"+String.fromCharCode(215)+" ("+e+") -> "+o.default.get(i.default,"queue.not-found"),"color: #a0dc3c;font-weight: bold;")},r.workerRunninLog=function(t){var e=u(t,5),r=e[0],n=e[1],o=e[2],i=e[3],a=e[4];console.groupCollapsed(r.name+" - "+o.label),c("%cchannel: "+i,"color: blue;"),c("%clabel: "+(o.label||""),"color: blue;"),c("%chandler: "+o.handler,"color: blue;"),c("%cpriority: "+o.priority,"color: blue;"),c("%cunique: "+(o.unique||"false"),"color: blue;"),c("%cretry: "+(n.retry||"1"),"color: blue;"),c("%ctried: "+(o.tried?o.tried+1:"1"),"color: blue;"),c("%ctag: "+(o.tag||""),"color: blue;"),c("%cargs:","color: blue;"),c(o.args||""),console.groupCollapsed("dependencies"),c.apply(void 0,function(t){{if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}}(a[r.name]||[])),console.groupEnd()},r.workerDoneLog=function(t){var e=u(t,3),r=e[0],n=e[1],o=e[2];!0===r?c("%c"+String.fromCharCode(10003)+" Task completed!","color: green;"):!r&&n.tried<o.retry?c("%cTask will be retried!","color: #d8410c;"):c("%c"+String.fromCharCode(10005)+" Task failed and freezed!","color: #ef6363;");console.groupEnd()},r.workerFailedLog=function(){c("%c"+String.fromCharCode(10005)+" Task failed!","color: red;"),console.groupEnd()};var o=n(t("object-path")),i=n(t("./enum/log.events"));function n(t){return t&&t.__esModule?t:{default:t}}function c(){var t;(t=console).log.apply(t,arguments)}},{"./enum/log.events":16,"object-path":4}],14:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.store={}}return n(t,[{key:"has",value:function(t){return Object.prototype.hasOwnProperty.call(this.store,t)}},{key:"get",value:function(t){return this.store[t]}},{key:"all",value:function(){return this.store}},{key:"bind",value:function(t,e){this.store[t]=e}},{key:"merge",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.store=Object.assign({},this.store,t)}},{key:"remove",value:function(t){return!!this.has(t)&&delete this.store[t]}},{key:"removeAll",value:function(){this.store={}}}]),t}();r.default=o},{}],15:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default={defaultStorage:"localstorage",prefix:"sq_jobs",timeout:1e3,limit:-1,principle:"fifo",debug:!0}},{}],16:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default={queue:{created:"New task created.",next:"Next task processing.",starting:"Queue listener starting.",stopping:"Queue listener stopping.",stopped:"Queue listener stopped.",empty:"channel is empty...","not-found":"worker not found",offline:"Disconnected",online:"Connected"},event:{created:"New event created",fired:"Event fired.","wildcard-fired":"Wildcard event fired."}}},{}],17:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.store={},this.verifierPattern=/^[a-z0-9-_]+:before$|after$|retry$|\*$/,this.wildcards=["*","error"],this.emptyFunc=function(){},this.store.before={},this.store.after={},this.store.retry={},this.store.wildcard={},this.store.error=this.emptyFunc,this.store["*"]=this.emptyFunc}return n(t,[{key:"on",value:function(t,e){if("function"!=typeof e)throw new Error("Event should be an function");this.isValid(t)&&this.add(t,e)}},{key:"emit",value:function(t,e){if(-1<this.wildcards.indexOf(t))this.wildcard.apply(this,[t].concat([t,e]));else{var r=this.getType(t),n=this.getName(t);if(this.store[r])(this.store[r][n]||this.emptyFunc).call(null,e)}this.wildcard("*",t,e)}},{key:"wildcard",value:function(t,e,r){this.store.wildcard[t]&&this.store.wildcard[t].call(null,e,r)}},{key:"add",value:function(t,e){if(-1<this.wildcards.indexOf(t))this.store.wildcard[t]=e;else{var r=this.getType(t),n=this.getName(t);this.store[r][n]=e}}},{key:"has",value:function(t){try{var e=t.split(":");return 1<e.length?!!this.store[e[1]][e[0]]:!!this.store.wildcard[e[0]]}catch(t){return!1}}},{key:"getName",value:function(t){return t.match(/(.*):.*/)[1]}},{key:"getType",value:function(t){return t.match(/^[a-z0-9-_]+:(.*)/)[1]}},{key:"isValid",value:function(t){return this.verifierPattern.test(t)||-1<this.wildcards.indexOf(t)}}]),t}();r.default=o},{}],18:[function(t,e,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(r,"__esModule",{value:!0}),r.canMultiple=r.createTimeout=r.successJobHandler=r.retryProcess=r.lockTask=r.failedJobHandler=r.removeTask=r.saveTask=r.getTasksWithoutFreezed=void 0;var o,i,a,u,c,s,f,l,h,p=O(t("babel-runtime/regenerator")),d="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(t){return void 0===t?"undefined":n(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":n(t)},y=(r.getTasksWithoutFreezed=(o=j(p.default.mark(function t(){return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S.call(this).all();case 2:return t.t0=x.excludeSpecificTasks.bind(["freezed"]),t.abrupt("return",t.sent.filter(t.t0));case 4:case"end":return t.stop()}},t,this)})),function(){return o.apply(this,arguments)}),r.saveTask=(i=j(p.default.mark(function t(e){var r;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S.call(this).save(P(e));case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}},t,this)})),function(t){return i.apply(this,arguments)}),r.removeTask=(a=j(p.default.mark(function t(e){var r;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S.call(this).delete(e);case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}},t,this)})),function(t){return a.apply(this,arguments)})),v=r.failedJobHandler=(u=j(p.default.mark(function t(e){return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",function(){var t=j(p.default.mark(function t(){return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return y.call(this,e._id),this.event.emit("error",e),T.call(this,k.workerFailedLog),t.next=5,this.next();case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}},t,this)})),function(t){return u.apply(this,arguments)}),g=r.lockTask=(c=j(p.default.mark(function t(e){var r;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S.call(this).update(e._id,{locked:!0});case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}},t,this)})),function(t){return c.apply(this,arguments)}),b=r.retryProcess=(s=j(p.default.mark(function t(e,r){var n,o;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return L.call(this,e,"retry"),(n=M.call(this,e,r)).locked=!1,t.next=5,S.call(this).update(e._id,n);case 5:return o=t.sent,t.abrupt("return",o);case 7:case"end":return t.stop()}},t,this)})),function(t,e){return s.apply(this,arguments)}),m=r.successJobHandler=(f=j(p.default.mark(function t(r,n){var o;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=this,t.abrupt("return",function(){var e=j(p.default.mark(function t(e){return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=4;break}C.call(o,r),t.next=6;break;case 4:return t.next=6,b.call(o,r,n);case 6:return A.call(o,"after",n,r.args),L.call(o,r,"after"),T.call(o,k.workerDoneLog,e,r,n),t.next=11,o.next();case 11:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return t.stop()}},t,this)})),function(t,e){return f.apply(this,arguments)});r.createTimeout=(l=j(p.default.mark(function t(){var e,r,n,o,i,a;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return clearTimeout(this.currentTimeout),t.next=3,S.call(this).fetch();case 3:if(void 0!==(e=t.sent.shift())){t.next=8;break}return T.call(this,k.queueEmptyLog,this.name()),E.call(this),t.abrupt("return",1);case 8:if(w.default.worker.has(e.handler)){t.next=16;break}return T.call(this,k.notFoundLog,e.handler),t.next=12,v.call(this,e);case 12:return t.t0=this,t.next=15,t.sent.call(t.t0);case 15:return t.abrupt("return",1);case 16:return r=w.default.worker.get(e.handler),n=new r,o=this.config.get("timeout"),i=[e,r,n],t.next=22,F.call.apply(F,[this].concat(i));case 22:return t.t1=this,a=t.sent.bind(t.t1),this.currentTimeout=setTimeout(a,o),t.abrupt("return",this.currentTimeout);case 26:case"end":return t.stop()}},t,this)})),function(){return l.apply(this,arguments)}),r.canMultiple=(h=j(p.default.mark(function t(e){return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("object"===(void 0===e?"undefined":d(e))&&!0===e.unique){t.next=2;break}return t.abrupt("return",!0);case 2:return t.next=4,this.hasByTag(e.tag);case 4:return t.t0=t.sent,t.abrupt("return",!1===t.t0);case 6:case"end":return t.stop()}},t,this)})),function(t){return h.apply(this,arguments)});r.checkPriority=P,r.db=S,r.logProxy=T,r.dispatchEvents=L,r.stopQueue=E,r.fireJobInlineEvent=A,r.successProcess=C,r.updateRetry=M,r.loopHandler=F,r.statusOff=function(){this.running=!1};var w=O(t("./queue")),x=(O(t("./channel")),O(t("./storage-capsule")),t("./utils")),k=t("./console");function O(t){return t&&t.__esModule?t:{default:t}}function _(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function j(t){return function(){var u=t.apply(this,arguments);return new Promise(function(i,a){return function e(t,r){try{var n=u[t](r),o=n.value}catch(t){return void a(t)}if(!n.done)return Promise.resolve(o).then(function(t){e("next",t)},function(t){e("throw",t)});i(o)}("next")})}}function P(t){return t.priority=t.priority||0,"number"!=typeof t.priority&&(t.priority=0),t}function S(){return this.storage.channel(this.name())}function T(t){if(this.config.get("debug")&&"function"==typeof t){for(var e=arguments.length,r=Array(1<e?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];t(r)}}function L(e,t){var r=this;return"tag"in e&&([[e.tag+":"+t,"fired"],[e.tag+":*","wildcard-fired"]].forEach(function(t){r.event.emit(t[0],e),T.call.apply(T,[r,k.eventFiredLog].concat(_(t)))}),!0)}function E(){this.stop(),clearTimeout(this.currentTimeout),T.call(this,k.queueStoppedLog,"stop")}function A(t,e,r){return!(!(0,x.hasMethod)(e,t)||!(0,x.isFunction)(e[t]))&&(e[t].call(e,r),!0)}function C(t){y.call(this,t._id)}function M(t,e){return"retry"in e||(e.retry=1),"tried"in t||(t.tried=0,t.retry=e.retry),t.tried+=1,t.tried>=e.retry&&(t.freezed=!0),t}function F(i,a,u){return t=j(p.default.mark(function t(){var e,r,n,o;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=this,t.next=3,g.call(r,i);case 3:return A.call(this,"before",u,i.args),L.call(this,i,"before"),n=w.default.workerDeps[a.name],o=Object.values(n||{}),T.call(this,k.workerRunninLog,a,u,i,r.name(),w.default.workerDeps),t.t1=(e=u.handle).call.apply(e,[u,i.args].concat(_(o))),t.next=11,m.call(r,i,u);case 11:return t.t2=r,t.t3=t.sent.bind(t.t2),t.t0=t.t1.then.call(t.t1,t.t3),t.next=16,v.call(r,i);case 16:t.t4=r,t.t5=t.sent.bind(t.t4),t.t0.catch.call(t.t0,t.t5);case 19:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)};var t}},{"./channel":11,"./console":13,"./queue":20,"./storage-capsule":21,"./utils":22,"babel-runtime/regenerator":1}],19:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,o=t("./queue"),i=(n=o)&&n.__esModule?n:{default:n};window.Queue=i.default,r.default=i.default},{"./queue":20}],20:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t};r.default=c;var o=u(t("./channel")),i=u(t("./container")),a=u(t("./config"));function u(t){return t&&t.__esModule?t:{default:t}}function c(t){this.config=new a.default(t)}c.FIFO="fifo",c.LIFO="lifo",c.drivers={},c.workerDeps={},c.worker=new i.default,c.prototype.container=new i.default,c.prototype.create=function(t){return this.container.has(t)||this.container.bind(t,new o.default(t,this.config)),this.container.get(t)},c.prototype.channel=function(t){if(!this.container.has(t))throw new Error('"'+t+'" channel not found');return this.container.get(t)},c.prototype.setTimeout=function(t){this.config.set("timeout",t)},c.prototype.setLimit=function(t){this.config.set("limit",t)},c.prototype.setPrefix=function(t){this.config.set("prefix",t)},c.prototype.setPrinciple=function(t){this.config.set("principle",t)},c.prototype.setDebug=function(t){this.config.set("debug",t)},c.prototype.setStorage=function(t){this.config.set("storage",t)},c.workers=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!(t instanceof Object))throw new Error("The parameters should be object.");c.worker.merge(t)},c.deps=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!(t instanceof Object))throw new Error("The parameters should be object.");c.workerDeps=t},c.use=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};c.drivers=n({},c.drivers,t)}},{"./channel":11,"./config":12,"./container":14}],21:[function(t,e,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(r,"__esModule",{value:!0});var c=o(t("babel-runtime/regenerator")),s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},f="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(t){return void 0===t?"undefined":n(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":n(t)},l=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}(),h=o(t("group-by")),p=t("./adapters"),d=t("./utils");function o(t){return t&&t.__esModule?t:{default:t}}function y(t){return function(){var u=t.apply(this,arguments);return new Promise(function(i,a){return function e(t,r){try{var n=u[t](r),o=n.value}catch(t){return void a(t)}if(!n.done)return Promise.resolve(o).then(function(t){e("next",t)},function(t){e("throw",t)});i(o)}("next")})}}var i=function(){function r(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),this.config=t,this.storage=this.initialize(e)}var e,t,n,o,i,a,u;return l(r,[{key:"initialize",value:function(t){return"object"===(void 0===t?"undefined":f(t))?t:"function"==typeof t?new t(this.config):"localstorage"===this.config.get("storage")?new p.LocalStorageAdapter(this.config):new p.InMemoryAdapter(this.config)}},{key:"channel",value:function(t){return this.storageChannel=t,this}},{key:"fetch",value:(u=y(c.default.mark(function t(){var e,r;return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.all();case 2:return t.t0=d.excludeSpecificTasks,e=t.sent.filter(t.t0),r=(0,h.default)(e,"priority"),t.abrupt("return",Object.keys(r).map(function(t){return parseInt(t,10)}).sort(function(t,e){return e-t}).reduce(this.reduceTasks(r),[]));case 6:case"end":return t.stop()}},t,this)})),function(){return u.apply(this,arguments)})},{key:"save",value:(a=y(c.default.mark(function t(e){var r,n;return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("object"===(void 0===e?"undefined":f(e))){t.next=2;break}return t.abrupt("return",!1);case 2:return t.next=4,this.storage.get(this.storageChannel);case 4:return r=t.sent,t.next=7,this.isExceeded();case 7:if(!t.sent){t.next=10;break}return console.warn("Task limit exceeded: The '"+this.storageChannel+"' channel limit is "+this.config.get("limit")),t.abrupt("return",!1);case 10:return n=this.prepareTask(e),r.push(n),t.next=14,this.storage.set(this.storageChannel,r);case 14:return t.abrupt("return",n._id);case 15:case"end":return t.stop()}},t,this)})),function(t){return a.apply(this,arguments)})},{key:"update",value:(i=y(c.default.mark(function t(e,r){var n,o;return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.all();case 2:if(n=t.sent,!((o=n.findIndex(function(t){return t._id===e}))<0)){t.next=6;break}return t.abrupt("return",!1);case 6:return n[o]=Object.assign({},n[o],r),t.next=9,this.storage.set(this.storageChannel,n);case 9:return t.abrupt("return",!0);case 10:case"end":return t.stop()}},t,this)})),function(t,e){return i.apply(this,arguments)})},{key:"delete",value:(o=y(c.default.mark(function t(e){var r,n;return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.all();case 2:if(r=t.sent,!((n=r.findIndex(function(t){return t._id===e}))<0)){t.next=6;break}return t.abrupt("return",!1);case 6:return delete r[n],t.next=9,this.storage.set(this.storageChannel,r.filter(function(t){return t}));case 9:return t.abrupt("return",!0);case 10:case"end":return t.stop()}},t,this)})),function(t){return o.apply(this,arguments)})},{key:"all",value:(n=y(c.default.mark(function t(){var e;return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.storage.get(this.storageChannel);case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"generateId",value:function(){return(65536*(1+Math.random())).toString(16)}},{key:"prepareTask",value:function(t){var e=s({},t);return e.createdAt=Date.now(),e._id=this.generateId(),e}},{key:"reduceTasks",value:function(r){var n=this;return function(t,e){return"lifo"===n.config.get("principle")?t.concat(r[e].sort(d.lifo)):t.concat(r[e].sort(d.fifo))}.bind(this)}},{key:"isExceeded",value:(t=y(c.default.mark(function t(){var e,r;return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.config.get("limit"),t.next=3,this.all();case 3:return t.t0=d.excludeSpecificTasks,r=t.sent.filter(t.t0),t.abrupt("return",!(-1===e||e>r.length));case 6:case"end":return t.stop()}},t,this)})),function(){return t.apply(this,arguments)})},{key:"clear",value:(e=y(c.default.mark(function t(e){return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.storage.clear(e);case 2:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})}]),r}();r.default=i},{"./adapters":8,"./utils":22,"babel-runtime/regenerator":1,"group-by":3}],22:[function(t,e,r){"use strict";function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function o(e){var t=Array.isArray(this)?this:["freezed","locked"],r=[];return t.forEach(function(t){r.push(!1===n(e,t)||!1===e[t])}),!(-1<r.indexOf(!1))}Object.defineProperty(r,"__esModule",{value:!0}),r.hasProperty=n,r.hasMethod=function(t,e){return t instanceof Object&&e in t},r.isFunction=function(t){return t instanceof Function},r.excludeSpecificTasks=o,r.utilClearByTag=function(t){if(!o.call(["locked"],t))return!1;return t.tag===this},r.fifo=function(t,e){return t.createdAt-e.createdAt},r.lifo=function(t,e){return e.createdAt-t.createdAt}},{}]},{},[19]);